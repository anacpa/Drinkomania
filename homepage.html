<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>Drinkomania</title>

    <script src="https://d3js.org/d3.v7.min.js"></script>

    <style>
        body {
            font-family: sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, 120px);
            gap: 20px;
        }
        .drink {
            width: 120px;
            height: 120px;
        }
        svg {
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
<h2>CÃ­rculos de Ingredientes</h2>
<div id="container" class="grid"></div>

<script>

// ------------------------------
// 1. Load CSV file
// ------------------------------
d3.csv("427 n, cat, alch, g, 6ingr 6 quant, inst - DataSet.csv").then(function(data) {

    // ------------------------------
    // 2. Collect all ingredients
    // ------------------------------
    let ingredients = new Set();

    data.forEach(row => {
        for (let i = 1; i <= 6; i++) {
            let ing = row[`Ingredient${i}`];
            if (ing && ing.trim() !== "") {
                ingredients.add(ing.trim());
            }
        }
    });

    ingredients = Array.from(ingredients);

    // ------------------------------
    // 3. Generate consistent colors
    // ------------------------------
    const colorScale = d3.scaleOrdinal()
        .domain(ingredients)
        .range(d3.schemeTableau20.concat(d3.schemeSet3));

    // ------------------------------
    // 4. Draw a pie chart per drink
    // ------------------------------
    const container = d3.select("#container");

    data.forEach(row => {
        let ingList = [];

        for (let i = 1; i <= 6; i++) {
            let ing = row[`Ingredient${i}`];
            if (ing && ing.trim() !== "") {
                ingList.push(ing.trim());
            }
        }

        if (ingList.length === 0) return;

        const div = container.append("div")
            .attr("class", "drink");

        const svg = div.append("svg")
            .attr("viewBox", "0 0 100 100");

        const g = svg.append("g")
            .attr("transform", "translate(50,50)");

        const pie = d3.pie()
            .value(d => 1)
            (ingList);

        const arc = d3.arc()
            .innerRadius(0)
            .outerRadius(50);

        g.selectAll("path")
            .data(pie)
            .enter()
            .append("path")
            .attr("d", arc)
            .attr("fill", d => colorScale(d.data));
    });

});

</script>

</body>
</html>
