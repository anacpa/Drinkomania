<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Drink Circles - p5.js</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
</head>

<body>
  <script>
let table;
let circles = [];
let colors = {};

function preload() {
  // <-- Carrega automaticamente o ficheiro CSV
  table = loadTable("427 n, cat, alch, g, 6ingr 6 quant, inst - DataSet.csv", "csv", "header");
}

function setup() {
  createCanvas(window.innerWidth, window.innerHeight);
  background(245);

  assignColors();
  generateCircles();
  noLoop();
}

function assignColors() {
  let ingredients = new Set();
  for (let r = 0; r < table.getRowCount(); r++) {
    for (let i = 1; i <= 6; i++) {
      let ing = table.getString(r, "Ingredient" + i);
      if (ing) ingredients.add(ing);
    }
  }

  // Paleta de cores fixa
  let palette = [
    '#e6194b','#3cb44b','#ffe119','#4363d8','#f58231','#911eb4',
    '#46f0f0','#f032e6','#bcf60c','#fabebe','#008080','#e6beff',
    '#9a6324','#fffac8','#800000','#aaffc3','#808000','#ffd8b1'
  ];

  let i = 0;
  [...ingredients].forEach(ing => {
    colors[ing] = palette[i % palette.length];
    i++;
  });
}

function generateCircles() {
  circles = [];

  for (let r = 0; r < table.getRowCount(); r++) {
    let row = table.getRow(r);
    let ingredients = [];

    for (let i = 1; i <= 6; i++) {
      let ing = row.getString("Ingredient" + i);
      if (ing) ingredients.push(ing);
    }

    circles.push({
      ingredients,
      x: (r % 10) * 120 + 80,
      y: floor(r / 10) * 120 + 80,
      size: 80
    });
  }
}

function draw() {
  background(245);
  circles.forEach(c => drawCircle(c));
}

function drawCircle(c) {
  let angleStep = TWO_PI / c.ingredients.length;
  let start = 0;

  c.ingredients.forEach(ing => {
    fill(colors[ing] || "#aaa");
    stroke(255);
    arc(c.x, c.y, c.size, c.size, start, start + angleStep, PIE);
    start += angleStep;
  });
}

  </script>
</body>
</html>
